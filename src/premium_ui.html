<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bike Share Analytics Assistant</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-orange: #D97742;
            --primary-orange-dark: #B8642F;
            --primary-orange-light: #F4E6D7;
            --text-primary: #1F2937;
            --text-secondary: #6B7280;
            --text-light: #9CA3AF;
            --border-light: #E5E7EB;
            --background-white: #FFFFFF;
            --background-gray: #F9FAFB;
            --background-orange-gradient: linear-gradient(135deg, #D97742 0%, #F4A460 100%);
            --shadow-soft: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-medium: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-large: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --border-radius: 12px;
            --border-radius-lg: 16px;
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--background-white);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Header Section */
        .header {
            padding: 2rem 1.5rem;
            text-align: center;
            background: var(--background-white);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--background-orange-gradient);
        }

        .logo {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 2rem;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: var(--background-orange-gradient);
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            font-weight: 600;
            box-shadow: var(--shadow-medium);
        }

        .logo-text {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.025em;
        }

        .hero-title {
            font-size: clamp(2.5rem, 5vw, 3.75rem);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            letter-spacing: -0.025em;
            line-height: 1.1;
        }

        .hero-subtitle {
            font-size: 1.25rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            font-weight: 400;
        }

        .hero-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .feature-card {
            background: var(--background-gray);
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius);
            padding: 1.25rem;
            text-align: left;
            transition: var(--transition);
        }

        .feature-card:hover {
            border-color: var(--primary-orange);
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .feature-icon {
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
        }

        .feature-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .feature-description {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.5;
        }

        /* Chat Interface */
        .chat-interface {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--background-white);
            margin: 0 1.5rem 1.5rem;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-large);
            border: 1px solid var(--border-light);
            overflow: hidden;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            min-height: 600px;
        }

        .chat-header {
            background: var(--background-gray);
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .chat-status {
            width: 8px;
            height: 8px;
            background: #10B981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .chat-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .messages {
            flex: 1;
            padding: 2rem 1.5rem;
            overflow-y: auto;
            scroll-behavior: smooth;
            background: var(--background-white);
        }

        .message {
            margin-bottom: 2rem;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: 600;
            flex-shrink: 0;
        }

        .message.assistant .message-avatar {
            background: var(--background-orange-gradient);
            color: white;
        }

        .message.user .message-avatar {
            background: var(--text-primary);
            color: white;
        }

        .message-content {
            flex: 1;
            max-width: 75%;
        }

        .message-bubble {
            padding: 1rem 1.25rem;
            border-radius: var(--border-radius);
            position: relative;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .message.assistant .message-bubble {
            background: var(--background-gray);
            border: 1px solid var(--border-light);
        }

        .message.user .message-bubble {
            background: var(--text-primary);
            color: white;
        }

        .message-time {
            font-size: 0.75rem;
            color: var(--text-light);
            margin-top: 0.5rem;
            text-align: right;
        }

        .message.assistant .message-time {
            text-align: left;
        }

        /* Code and Result Blocks */
        .sql-block {
            background: #1F2937;
            color: #F9FAFB;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            font-size: 0.875rem;
            overflow-x: auto;
            border-left: 4px solid var(--primary-orange);
            position: relative;
        }

        .sql-block::before {
            content: 'SQL';
            position: absolute;
            top: 0.5rem;
            right: 0.75rem;
            font-size: 0.75rem;
            color: var(--text-light);
            font-weight: 500;
        }

        .result-block {
            background: #F0F9FF;
            border: 1px solid #0EA5E9;
            border-left: 4px solid #0EA5E9;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            font-size: 0.875rem;
            position: relative;
        }

        .result-block::before {
            content: 'Result';
            position: absolute;
            top: 0.5rem;
            right: 0.75rem;
            font-size: 0.75rem;
            color: #0369A1;
            font-weight: 500;
        }

        .error-block {
            background: #FEF2F2;
            border: 1px solid #F87171;
            border-left: 4px solid #EF4444;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            color: #B91C1C;
        }

        /* Input Section */
        .input-section {
            padding: 1.5rem;
            background: var(--background-white);
            border-top: 1px solid var(--border-light);
        }

        .input-container {
            position: relative;
            max-width: 100%;
        }

        .input-field {
            width: 100%;
            min-height: 56px;
            padding: 1rem 4rem 1rem 1.25rem;
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius-lg);
            font-size: 1rem;
            font-family: inherit;
            resize: none;
            outline: none;
            transition: var(--transition);
            background: var(--background-white);
            color: var(--text-primary);
            line-height: 1.5;
        }

        .input-field:focus {
            border-color: var(--primary-orange);
            box-shadow: 0 0 0 3px rgba(217, 119, 66, 0.1);
        }

        .input-field::placeholder {
            color: var(--text-light);
        }

        .send-button {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background: var(--background-orange-gradient);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            box-shadow: var(--shadow-soft);
        }

        .send-button:hover:not(:disabled) {
            transform: translateY(-50%) scale(1.05);
            box-shadow: var(--shadow-medium);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: translateY(-50%);
        }

        .send-icon {
            width: 18px;
            height: 18px;
        }

        /* Example Questions */
        .examples-section {
            margin-top: 1rem;
        }

        .examples-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
        }

        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 0.75rem;
        }

        .example-button {
            background: var(--background-gray);
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius);
            padding: 0.875rem 1rem;
            text-align: left;
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .example-button:hover {
            border-color: var(--primary-orange);
            background: var(--primary-orange-light);
            color: var(--text-primary);
        }

        /* Loading States */
        .loading-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid var(--border-light);
            border-top: 2px solid var(--primary-orange);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Welcome Message */
        .welcome-message {
            background: var(--primary-orange-light);
            border: 1px solid var(--primary-orange);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .welcome-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .welcome-text {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                margin: 0;
            }

            .header {
                padding: 1.5rem 1rem;
            }

            .hero-title {
                font-size: 2.5rem;
            }

            .hero-features {
                grid-template-columns: 1fr;
            }

            .chat-interface {
                margin: 0 1rem 1rem;
                border-radius: var(--border-radius);
                min-height: 500px;
            }

            .message-content {
                max-width: 85%;
            }

            .examples-grid {
                grid-template-columns: 1fr;
            }

            .input-field {
                padding-right: 3.5rem;
            }

            .send-button {
                width: 36px;
                height: 36px;
            }
        }

        @media (max-width: 480px) {
            .hero-title {
                font-size: 2rem;
            }

            .hero-subtitle {
                font-size: 1.125rem;
            }

            .messages {
                padding: 1rem;
            }

            .input-section {
                padding: 1rem;
            }
        }

        /* Dark mode support (for future) */
        @media (prefers-color-scheme: dark) {
            :root {
                --text-primary: #F9FAFB;
                --text-secondary: #D1D5DB;
                --text-light: #9CA3AF;
                --background-white: #111827;
                --background-gray: #1F2937;
                --border-light: #374151;
            }
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus indicators */
        .example-button:focus,
        .input-field:focus,
        .send-button:focus {
            outline: 2px solid var(--primary-orange);
            outline-offset: 2px;
        }

        /* Result text styling */
        .message.assistant .message-bubble p {
            white-space: pre-wrap;
            line-height: 1.6;
            color: #000;
        }

        .message.assistant .message-bubble p strong {
            font-weight: bold;
            color: #D97742;
            font-size: 1.1rem;
            background: #F4E6D7;
            padding: 0.5rem;
            border-radius: 8px;
            border-left: 4px solid #D97742;
            display: inline-block;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <div class="logo-icon">🚴</div>
                <div class="logo-text">BikeShare AI</div>
            </div>
            
            <h1 class="hero-title">Analytics Assistant</h1>
            <p class="hero-subtitle">Ask questions about bike share data in natural language. Get instant insights with AI-powered analytics.</p>
            
            <div class="hero-features">
                <div class="feature-card">
                    <div class="feature-icon">🧠</div>
                    <div class="feature-title">Natural Language Processing</div>
                    <div class="feature-description">Ask complex questions in plain English and get precise SQL queries automatically generated</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">🔒</div>
                    <div class="feature-title">Enterprise Security</div>
                    <div class="feature-description">Built with security-first approach using parameterized queries and input validation</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">⚡</div>
                    <div class="feature-title">Real-time Analytics</div>
                    <div class="feature-description">Instant results from PostgreSQL database with intelligent column mapping</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">📊</div>
                    <div class="feature-title">Smart Insights</div>
                    <div class="feature-description">Semantic understanding of your data structure with dynamic schema discovery</div>
                </div>
            </div>
        </header>

        <main class="chat-interface">
            <div class="chat-header">
                <div class="chat-status"></div>
                <div class="chat-title">Ready to analyze your bike share data</div>
            </div>

            <div class="messages" id="messages">
                <div class="message assistant">
                    <div class="message-avatar">AI</div>
                    <div class="message-content">
                        <div class="message-bubble">
                            <div class="welcome-message">
                                <div class="welcome-title">Welcome to BikeShare Analytics Assistant!</div>
                                <div class="welcome-text">
                                    I can help you analyze bike share data using natural language. Simply ask questions like "How many trips were made last month?" or "Which station is most popular?" and I'll convert them to SQL queries and show you the results.
                                </div>
                            </div>
                        </div>
                        <div class="message-time">Just now</div>
                    </div>
                </div>
            </div>

            <div class="input-section">
                <form id="queryForm">
                    <div class="input-container">
                        <textarea 
                            class="input-field" 
                            id="questionInput" 
                            placeholder="Ask a question about bike share data..."
                            rows="1"
                            required
                            aria-label="Ask a question about bike share data"
                        ></textarea>
                        <button type="submit" class="send-button" id="sendButton" aria-label="Send question">
                            <svg class="send-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                </form>

                <div class="examples-section">
                    <div class="examples-title">Try these example questions:</div>
                    <div class="examples-grid">
                        <button class="example-button" data-question="What was the average ride time for journeys that started at Congress Avenue in June 2025?">
                            What was the average ride time for journeys that started at Congress Avenue in June 2025?
                        </button>
                        <button class="example-button" data-question="Which docking point saw the most departures during the first week of June 2025?">
                            Which docking point saw the most departures during the first week of June 2025?
                        </button>
                        <button class="example-button" data-question="How many kilometres were ridden by women on rainy days in June 2025?">
                            How many kilometres were ridden by women on rainy days in June 2025?
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Simple working JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            const messagesContainer = document.getElementById('messages');
            const questionInput = document.getElementById('questionInput');
            const sendButton = document.getElementById('sendButton');
            const queryForm = document.getElementById('queryForm');

            // Send button click
            sendButton.addEventListener('click', function(e) {
                e.preventDefault();
                const question = questionInput.value.trim();
                if (question) {
                    askQuestion(question);
                    questionInput.value = '';
                }
            });

            // Form submit
            queryForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const question = questionInput.value.trim();
                if (question) {
                    askQuestion(question);
                    questionInput.value = '';
                }
            });

            // Example buttons
            const exampleButtons = document.querySelectorAll('.example-button');
            exampleButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const question = this.getAttribute('data-question');
                    if (question) {
                        questionInput.value = question;
                        askQuestion(question);
                        questionInput.value = '';
                    }
                });
            });

            async function askQuestion(question) {
                // Add user message
                addMessage('user', question);
                
                // Show loading
                const loadingId = addLoadingMessage();
                sendButton.disabled = true;
                
                try {
                    const response = await fetch('/query', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ question })
                    });
                    
                    const data = await response.json();
                    removeMessage(loadingId);
                    addResponse(data);
                    
                } catch (error) {
                    removeMessage(loadingId);
                    addMessage('assistant', 'Error: ' + error.message);
                } finally {
                    sendButton.disabled = false;
                }
            }

            function addMessage(sender, content) {
                const div = document.createElement('div');
                div.className = `message ${sender}`;
                div.innerHTML = `
                    <div class="message-avatar">${sender === 'user' ? 'You' : 'AI'}</div>
                    <div class="message-content">
                        <div class="message-bubble"><p>${content}</p></div>
                        <div class="message-time">${new Date().toLocaleTimeString()}</div>
                    </div>
                `;
                messagesContainer.appendChild(div);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            function addLoadingMessage() {
                const id = 'loading-' + Date.now();
                const div = document.createElement('div');
                div.id = id;
                div.className = 'message assistant';
                div.innerHTML = `
                    <div class="message-avatar">AI</div>
                    <div class="message-content">
                        <div class="message-bubble">
                            <div class="loading-message">
                                <div class="spinner"></div>
                                <span>Processing...</span>
                            </div>
                        </div>
                    </div>
                `;
                messagesContainer.appendChild(div);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                return id;
            }

            function removeMessage(id) {
                const element = document.getElementById(id);
                if (element) element.remove();
            }

                         function addResponse(data) {
                 if (data.error) {
                     addMessage('assistant', `Error: ${data.error}`);
                 } else {
                     let content = '';
                     if (data.sql) {
                         content += `SQL Query:\n${data.sql}\n\n`;
                     }
                     
                     let resultText = '';
                     if (typeof data.result === 'object' && Array.isArray(data.result)) {
                         if (data.result.length === 0) {
                             resultText = 'No results found';
                         } else if (data.result.length === 1 && Object.keys(data.result[0]).length === 1) {
                             resultText = String(Object.values(data.result[0])[0]);
                         } else {
                             resultText = JSON.stringify(data.result, null, 2);
                         }
                     } else {
                         resultText = String(data.result);
                     }
                     content += `<strong>Result: ${resultText}</strong>`;
                     addMessage('assistant', content);
                 }
             }

            // Focus input
            questionInput.focus();
        });
    </script>

